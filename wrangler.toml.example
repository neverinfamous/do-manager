# Cloudflare Durable Object Manager - Wrangler Configuration Template
# Copy this file to wrangler.toml and customize for your Cloudflare account
#
# NOTE: This is the PRODUCTION configuration.
# For local development, use wrangler.dev.toml instead.

name = "do-manager"
main = "worker/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Smart Placement disabled for SPA - UI responsiveness priority
placement = { mode = "off" }

[build]
command = "npm run build"
cwd = "."

[assets]
directory = "dist"
binding = "ASSETS"

# ============================================
# D1 METADATA DATABASE CONFIGURATION
# ============================================
# This database stores namespace configs, instance tracking, and job history
# Create database: wrangler d1 create do-manager-metadata
# Then run: wrangler d1 execute do-manager-metadata --remote --file=worker/schema.sql
[[d1_databases]]
binding = "METADATA"
database_name = "do-manager-metadata"  # CHANGE THIS
database_id = "your-metadata-database-id"  # CHANGE THIS (from wrangler d1 create output)

# ============================================
# R2 BACKUP BUCKET (OPTIONAL)
# ============================================
# For backing up Durable Object state snapshots
# Create with: wrangler r2 bucket create do-manager-backups
[[r2_buckets]]
binding = "BACKUP_BUCKET"
bucket_name = "do-manager-backups"

[observability.logs]
enabled = true

# ============================================
# CUSTOM DOMAIN ROUTING (OPTIONAL)
# ============================================
# Option 1: Use default Workers.dev subdomain (no configuration needed)
#   Your worker will be available at: https://do-manager.<your-subdomain>.workers.dev
#
# Option 2: Use custom domain (uncomment and configure below)
#   Requirements:
#   - Domain must be added to your Cloudflare account
#   - DNS must be managed by Cloudflare
#
# [[routes]]
# pattern = "your-subdomain.your-domain.com"  # CHANGE THIS
# custom_domain = true
# zone_name = "your-domain.com"               # CHANGE THIS

# ============================================
# REQUIRED SECRETS (Set via CLI)
# ============================================
# Run these commands to set your secrets:
#
#   wrangler secret put ACCOUNT_ID
#   wrangler secret put API_KEY
#   wrangler secret put TEAM_DOMAIN
#   wrangler secret put POLICY_AUD
#
# Secret details:
# - ACCOUNT_ID: Your Cloudflare account ID (Dashboard > Overview)
# - API_KEY: Cloudflare API token with Workers Scripts Read permission
# - TEAM_DOMAIN: Cloudflare Zero Trust team domain (e.g., yourteam.cloudflareaccess.com)
# - POLICY_AUD: Access Policy AUD tag from your Access application
#
# ============================================
# LOCAL DEVELOPMENT
# ============================================
# For local development, use wrangler.dev.toml instead of this file.
# See README.md "Local Development" section for instructions.
#
# Quick start:
#   Terminal 1: npm run dev
#   Terminal 2: npx wrangler dev --config wrangler.dev.toml --local

